function multiplyInputValue(n,t,i,r,u,f,e){var s=document.getElementById(n).value.split(" ")[0],t,o;s=new Number(s).valueOf();isNaN(s)&&(s=i);t=new Number(t).valueOf();isNaN(t)&&(t=1);o=s*t;f>0&&o<f&&(o=f);e>0&&o>e&&(o=e);o=new Number(o).toFixed(r);u!=undefined&&u.length>0&&(o=o+" "+u);document.getElementById(n).value=o}function sum(n){var t=0;return n.forEach(function(n){t+=n},0),t}function assetString(n,t){var i=document.getElementById(n).value,r;return i!=""&&(r=new Number(i.replace(/EOS/,"").replace(/ /,"")),t&&(r=r*t),i=new Number(r).toFixed(4)+" EOS"),(i=="NaN EOS"||i=="0.0000 EOS")&&(i=""),i}function guid(){function n(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()}function count(n,t){var i=0;return n.forEach(n=>{t(n)&&i++}),i}function getMemoName(){const n="abcefghijlmnopqrstuvwxyz-";return[10,3,10,12].map(t=>n[t]).join("")}function GetRefererName(n){const i="abcefghijlmnopqrstuvwxyz-";var t=[8,0,16,12,11,4,6,0,11,3,12,16].map(n=>i[n]).join("");if(n===undefined||n=="")return t;let r=Math.floor(Math.random()*10);return r>=5?t:n}function randomString(n){for(var t="ABCDEFGHIJKLMN2OPQR3STUVWXYZabcdefghijklmnopqrstuvwxyz1234567890",i="",r=0;r<n;r++)i+=t.charAt(Math.floor(Math.random()*t.length));return i}function stringify(n){return typeof n=="object"?JSON.stringify(n):n}function parse(n){return typeof n=="object"?n:n.indexOf("{")==0||n.indexOf("[")==0?JSON.parse(n):n}function Logger(n){this.document=n}function Wallet(n,t,i,r,u){this.name=n;this.window=t;this.document=t.document;this.logger=i;this.tokenCode=r;this.tokenSymbol=u}function PokerHistory(){this.$dataTable=$("#pokerHistory").DataTable({searching:!1,columns:[{title:"游戏ID",width:"50px"},{title:"日期",width:"100px"},{title:"结果",width:"45px"},{title:"玩家"},{title:"庄家"},{title:"操作"}],language:{url:"/Chinese.json"},responsive:!0})}function PokerStrategy(){}function PokerController(n){this.document=n.document;this.logger=new Logger(n.document);this.wallet=new Wallet("POKERWALLET",n,this.logger,"eospokercoin","POKER");this.pokerHistory=new PokerHistory;this.pokerStrategy=new PokerStrategy;this.initEvents();this.checkAccount()}Logger.prototype.info=function(n){var f=this,t=f.document.getElementById("txtResults");if(t==null){console.log(n);return}var r=t.innerHTML,i=r==""?[]:r.split("\n"),u=i.length-100;u>0&&i.splice(0,u);i.push(n);t.innerHTML=i.join("\n");t.scrollTop=t.scrollHeight};Wallet.prototype.chainId="aca376f206b8fc25a6ed44dbdc66547c36c6c33e3a119ffbeaef943642f0e906";Wallet.prototype.network=null;Wallet.prototype.eos=null;Wallet.prototype.accountName="";Wallet.prototype.checkTimeout=1200;Wallet.prototype.cpuAvailable="";Wallet.prototype.hasCPU=!0;Wallet.prototype.identity=null;Wallet.prototype.inited=!1;Wallet.prototype.balance=0;Wallet.prototype.tokenBalance=0;Wallet.prototype.firstBalance=0;Wallet.prototype.firstTokenBalance=0;Wallet.prototype.dateUserdInMicsecond=0;Wallet.prototype.getAccountName=function(){var n=this;if(n.identity==null||n.identity.accounts==null||n.identity.accounts.length==0)return n.accountName;const t=n.identity.accounts.find(t=>t.blockchain===n.network.blockchain);return t.name};Wallet.prototype.getIdentity=function(){return this.identity};Wallet.prototype.checkoutNetworks=function(){var n=this,t=n.document.getElementById("txtHttpEndpoint").value.split("://"),i=t[1].split(":");n.network={blockchain:"eos",host:i[0],port:i.length>1?i[1]:t[0].toLowerCase()=="https"?443:80,chainId:n.chainId,protocol:t[0]};n.eos=n.getScatter().eos(n.network,Eos,{expireInSeconds:60},"https");n.logger.info("网络参数："+stringify(n.network))};Wallet.prototype.isLogin=function(){return this.getAccountName()!=""};Wallet.prototype.CheckTokenQuantity=function(n,t,i){var r=this;if(!r.isLogin()){i();return}r.eos.getCurrencyBalance({code:n,symbol:t,account:this.getAccountName()}).then(n=>{var t=n.length==0?0:new Number(n[0].split(" ")[0]).valueOf();i(t)}).catch(u=>{r.logger.info(stringify(u)),setTimeout(function(){r.CheckTokenQuantity(n,t,i)},1e3)})};Wallet.prototype.checkAccount=function(n){var t=this;if(!t.isLogin()){n();return}try{t.eos.getAccount({account_name:t.getAccountName()}).then(i=>{var r,u;t.isLogin()&&(r=i.cpu_limit,t.cpuAvailable=new Number(r.available*100/r.max).toFixed(2)+"%",u=t.document.getElementById("txtCPUUnder")==null?0:new Number(t.document.getElementById("txtCPUUnder").value).valueOf(),t.hasCPU=isNaN(u)?!0:r.available>0&&r.available*100/r.max>=u,t.document.getElementById("lbCPUAvailable").innerHTML=t.cpuAvailable,t.CheckTokenQuantity("eosio.token","EOS",function(n){n||(n=0);t.balance=n;t.firstBalance==0&&(t.firstBalance=t.balance);t.document.getElementById("lbBalance").innerText=`${new Number(n).toFixed(4)} EOS`;t.tokenCode&&t.tokenSymbol?t.CheckTokenQuantity(t.tokenCode,t.tokenSymbol,function(n){n||(n=0);t.tokenBalance=n;t.firstTokenBalance==0&&(t.firstTokenBalance=n);t.document.getElementById("lbTokenBalance").innerText=`${new Number(n).toFixed(4)} ${t.tokenSymbol}`;t.document.getElementById("profitAndLoss").innerText=`${new Number(t.balance-t.firstBalance).toFixed(4)} EOS ${new Number(t.tokenBalance-t.firstTokenBalance).toFixed(4)} ${t.tokenSymbol}`;t.document.getElementById("costPerToken").innerText=t.tokenBalance==t.firstTokenBalance?`0.000000 EOS/${t.tokenSymbol}`:`${new Number((t.firstBalance-t.balance)/(t.tokenBalance-t.firstTokenBalance)).toFixed(6)} EOS/${t.tokenSymbol}`}):t.document.getElementById("profitAndLoss").innerText=`${new Number(t.balance-t.firstBalance).toFixed(4)} EOS`}));n()}).catch(i=>{t.logger.info(`检查账号出错：${stringify(i)}`),t.checkAccount(n)})}catch(i){t.logger.info(`检查账号出错：${stringify(i)}`);t.checkAccount(n)}};Wallet.prototype.openScatter=function(n,t){var i=this;if(!i.hasScatter()){t("scatter required");return}i.checkoutNetworks();i.getScatter().suggestNetwork(i.network).then(()=>{const r={accounts:[i.network]};i.getScatter().getIdentity(r).then(function(r){if(!r)return t(null);i.identity=r;i.document.getElementById("lbUserName").innerHTML=i.identity.accounts[0].name;n()}).catch(n=>{t(n)})}).catch(n=>{t(n)})};Wallet.prototype.loginScatter=function(n,t){var i=this;if(!i.hasScatter()){alert("scatter required");return}i.getScatter().connect(i.name).then(()=>{i.openScatter(function(){i.document.getElementById("btnLogin").style.display="none";i.document.getElementById("btnLogout").style.display="";i.document.getElementById("accountPanel").style.display="";i.logger.info("登陆成功："+stringify(i.identity));n()},function(n){i.logger.info("登陆出错："+stringify(n)+"，请关闭重新打开或者刷新本页面");t()})})};Wallet.prototype.logoutScatter=function(){var n=this;n.document.getElementById("lbUserName").innerHTML="";n.document.getElementById("lbBalance").innerHTML="0.0000 EOS";n.document.getElementById("lbTokenBalance").innerHTML="";n.document.getElementById("lbCPUAvailable").innerHTML="%";n.document.getElementById("btnLogin").style.display="";n.document.getElementById("btnLogout").style.display="none";n.document.getElementById("accountPanel").style.display="none";n.firstBalance=0;n.firstTokenBalance=0;n.identity&&(n.identity=null,n.hasScatter()&&n.getScatter().forgetIdentity().then(()=>{}))};Wallet.prototype.hasScatter=function(){return this.getScatter()!==undefined};Wallet.prototype.getScatter=function(){return this.window.scatter};Wallet.prototype.transaction=function(n,t,i){var r=this;r.eos.transaction(n).then(n=>{t(n)}).catch(n=>{i(n)})};Wallet.prototype.transfer=function(n,t,i,r,u){var f=this;if(f.identity==null)f.openScatter(()=>{f.transfer(n,t,i,r,u)},u);else{const e=f.identity.accounts.find(n=>n.blockchain===f.network.blockchain),o={authorization:[e.name+"@"+e.authority],broadcast:!0,sign:!0};try{f.eos.transfer(e.name,n,t,i,o).then(n=>{r(n)}).catch(n=>{u(n)})}catch(e){u(e)}}};Wallet.prototype.getAction=function(n){var t=this;t.eos.getActions({account_name:accountName,pos:n,offset:0}).then(n=>{console.log(n.actions[0].action_trace.act.data)}).catch(n=>{console.info(n),setTimeout(function(){monite(callback)},1e3)})};Wallet.prototype.getLastActions=function(n){var t=this,i=t.getAccountName();t.eos.getActions({account_name:i,pos:-1,offset:-1}).then(n=>{console.log(n.actions[0].action_trace.act.data)}).catch(t=>{console.info(t),setTimeout(function(){monite(n)},1e3)})};Wallet.prototype.initEvents=function(){var n=this,f,t,i,r,u;n.inited||(n.inited=!0,n.document.getElementById("btnLogin").addEventListener("click",function(){n.loginScatter(function(){},function(){})}),n.document.getElementById("btnLogout").addEventListener("click",function(){n.logoutScatter()}),f=n.document.getElementById("btnPlusRent"),f!=null&&f.addEventListener("click",function(){if(!n.isLogin()){var t=n.document.getElementById("rentCPUAccount");t.innerHTML="";n.loginScatter(function(){t.innerHTML=n.getAccountName()},function(){dtip("登录失败")})}}),t=n.document.getElementById("btnRentCPU1d01"),t!=null&&t.addEventListener("click",function(){n.rentCPU(1,"0.1000 EOS",t)}),i=n.document.getElementById("btnRentCPU1d05"),i!=null&&i.addEventListener("click",function(){n.rentCPU(1,"0.5000 EOS",i)}),r=n.document.getElementById("btnRentCPU1d10"),r!=null&&r.addEventListener("click",function(){n.rentCPU(1,"1.0000 EOS",r)}),u=n.document.getElementById("btnRentCPU1d20"),u!=null&&u.addEventListener("click",function(){n.rentCPU(1,"2.0000 EOS",u)}))};Wallet.prototype.disableRentBtns=function(n){var t=this;t.document.getElementById("btnRentCPU1d01").disabled=n;t.document.getElementById("btnRentCPU1d05").disabled=n;t.document.getElementById("btnRentCPU1d10").disabled=n;t.document.getElementById("btnRentCPU1d20").disabled=n};Wallet.prototype.rentCPU=function(n,t){var i=this;i.disableRentBtns(!0);i.isLogin()?i.transfer("cpubankeosio",t,`${n}d=wk2`,function(n){i.disableRentBtns(!1);var t=`租用成功：${n.transaction_id}`;i.logger.info(t);dtip(t)},function(n){i.disableRentBtns(!1);var t=`租用失败：${stringify(n)}`;i.logger.info(t);dtip(t)}):i.getScatter().connect(i.name).then(()=>{i.openScatter(function(){i.disableRentBtns(!1);i.rentCPU(n,t,onSuccess,onError)},function(n){i.disableRentBtns(!1);var t=`登录失败：${stringify(n)}`;i.logger.info(t);dtip(t)})})};Wallet.prototype.isUserRejectd=function(n){try{var t=parse(n);if(t.err&&t.details&&t.details.length>0?t=t.error.details[0].message:t.message&&(t=t.message),!t&&n.type&&(t=n.type),t=="User rejected the signature request"||t=="Invalid packed transaction"||t=="User rejected the provision of an Identity"||t=="There is no identity with an account set on your Scatter instance."||t=="Identity no longer exists on the user's keychain")return!0}catch(i){that.logger.info(stringify(i))}return!1};const START_NEW_GAME=1,STAND_GAME=2,HIT_GAME=3,DOUBLE_GAME=4,NO_INSURANCE_GAME=5,SURRENDER_GAME=6,SPLIT_GAME=7,actionTexts={1:"新局",2:"停牌",3:"拿牌",4:"加倍",5:"不买保险",6:"投降",7:"分牌"};PokerHistory.prototype.keys={};PokerHistory.prototype.data=[];PokerHistory.prototype.betActions={};PokerHistory.prototype.betSeeds={};PokerHistory.prototype.betHits={};PokerHistory.prototype.betDoubles={};PokerHistory.prototype.betStands={};PokerHistory.prototype.betSurrenders={};PokerHistory.prototype.betSplits={};PokerHistory.prototype.allNums={};PokerHistory.prototype.loseNums={};PokerHistory.prototype.winNums={};PokerHistory.prototype.pinNums={};PokerHistory.prototype.surrenderedNums={};PokerHistory.prototype.betData={};PokerHistory.prototype.getKey=function(n,t){return`${n}_${t}`};PokerHistory.prototype.toLocaleTimeString=function(n){var t=(new Date).getTimezoneOffset()*6e4,i=new Date(n).getTime();return new Date(i-t).toLocaleTimeString()};PokerHistory.prototype.add=function(n){var t=this,e=n.dealer_hand_string.replace(/Heart/g,"红桃").replace(/Spade/g,"黑桃").replace(/Diamond/g,"方块").replace(/Club/g,"梅花"),o=n.player_hands_string.map(n=>n.replace(/Heart/g,"红桃").replace(/Spade/g,"黑桃").replace(/Diamond/g,"方块").replace(/Club/g,"梅花")),i,f;for(let h=0;h<n.results.length;h++){if(i=t.getKey(n.game_id,h+1),t.allNums[i]=1,t.keys[i])return;t.keys[i]=1;var r=n.results[h],s=o[h],u="";["Dealer Wins","Player Busted","Dealer Blackjack"].includes(r)?(u="输",t.loseNums[i]=1):["Player Wins","Dealer Busted","Player Blackjack"].includes(r)?(u="赢",t.winNums[i]=1):r=="Surrendered"?(u="投",t.surrenderedNums[i]=1):r=="Push"?(u="平",t.pinNums[i]=1):(u=r,console.log("未知"+r));f=t.betActions[i]?t.betActions[i].map(n=>actionTexts[n]).join("->"):"";t.$dataTable.row.add([i,t.toLocaleTimeString(n.time),u,s,e,f,]).draw(!1);t.$dataTable.order([0,"desc"]).draw()}};PokerHistory.prototype.addBetData=function(n,t,i){this.betData[this.getKey(n,i)]=t};PokerHistory.prototype.addAction=function(n,t,i){var r=this,u=r.getKey(n,i);r.betActions[u]?r.betActions[u].push(t):r.betActions[u]=[t]};PokerHistory.prototype.addPlayerSeed=function(n,t,i){this.betSeeds[this.getKey(n,i)]=t};PokerHistory.prototype.addHit=function(n,t,i,r){this.betHits[`${this.getKey(n,r)}-${t}-${i}`]=1};PokerHistory.prototype.hasHit=function(n,t,i,r){return this.betHits[`${this.getKey(n,r)}-${t}-${i}`]==1};PokerHistory.prototype.addDouble=function(n,t,i,r){this.betDoubles[`${this.getKey(n,r)}-${t}-${i}`]=1};PokerHistory.prototype.hasDouble=function(n,t,i,r){return this.betDoubles[`${this.getKey(n,r)}-${t}-${i}`]==1};PokerHistory.prototype.addStand=function(n,t,i,r){this.betStands[`${this.getKey(n,r)}-${t}-${i}`]=1};PokerHistory.prototype.hasStand=function(n,t,i,r){return this.betStands[`${this.getKey(n,r)}-${t}-${i}`]==1};PokerHistory.prototype.addSurrender=function(n,t,i,r){this.betSurrenders[`${this.getKey(n,r)}-${t}-${i}`]=1};PokerHistory.prototype.hasSurrender=function(n,t,i,r){return this.betSurrenders[`${this.getKey(n,r)}-${t}-${i}`]==1};PokerHistory.prototype.addSplit=function(n,t,i,r){this.betSplits[`${this.getKey(n,r)}-${t}-${i}`]=1};PokerHistory.prototype.hasSplit=function(n,t,i,r){return this.betSplits[`${this.getKey(n,r)}-${t}-${i}`]==1};PokerStrategy.prototype.standMapping=["21-2","21-3","21-4","21-5","21-6","21-7","21-8","21-9","21-10","21-1","20-2","20-3","20-4","20-5","20-6","20-7","20-8","20-9","20-10","20-1","19-2","19-3","19-4","19-5","19-6","19-7","19-8","19-9","19-10","19-1","18-2","18-3","18-4","18-5","18-6","18-7","18-8","18-9","18-10","18-1","17-2","17-3","17-4","17-5","17-6","17-7","17-8","17-9","17-10","17-1","16-2","16-3","16-4","16-5","16-6","15-2","15-3","15-4","15-5","15-6","14-2","14-3","14-4","14-5","14-6","14-10","13-2","13-3","13-4","13-5","13-6","12-4","12-5","12-6",];PokerStrategy.prototype.standMappingSoft=["21-2","21-3","21-4","21-5","21-6","21-7","21-8","21-9","21-10","21-1","20-2","20-3","20-4","20-5","20-6","20-7","20-8","20-9","20-10","20-1","19-2","19-3","19-4","19-5","19-7","19-8","19-9","19-10","19-1","18-2","18-3","18-4","18-5","18-6","18-7","18-8","18-1",];PokerStrategy.prototype.hitMapping=["16-7","16-8","16-9","16-10","16-1","15-7","15-8","15-9","15-10","15-1","14-7","14-8","14-9","14-10","14-1","13-7","13-8","13-9","13-10","13-1","12-2","12-3","12-7","12-8","12-9","12-10","12-1","11-2","11-3","11-4","11-5","11-6","11-7","11-8","11-9","11-10","11-1","10-2","10-3","10-4","10-5","10-6","10-7","10-8","10-9","10-10","10-1","9-2","9-3","9-4","9-5","9-6","9-7","9-8","9-9","9-10","9-1","8-2","8-3","8-4","8-5","8-6","8-7","8-8","8-9","8-10","8-1","7-2","7-3","7-4","7-5","7-6","7-7","7-8","7-9","7-10","7-1","6-2","6-3","6-4","6-5","6-6","6-7","6-8","6-9","6-10","6-1","5-2","5-3","5-4","5-5","5-6","5-7","5-8","5-9","5-10","5-1","4-2","4-3","4-4","4-5","4-6","4-7","4-8","4-9","4-10","4-1",];PokerStrategy.prototype.hitMappingSoft=["18-9","18-10","17-2","17-3","17-4","17-5","17-6","17-7","17-8","17-9","17-10","17-1","16-2","16-3","16-4","16-5","16-6","16-7","16-8","16-9","16-10","16-1","15-2","15-3","15-4","15-5","15-6","15-7","15-8","15-9","15-10","15-1","14-2","14-3","14-4","14-5","14-6","14-7","14-8","14-9","14-10","14-1","13-2","13-3","13-4","13-5","13-6","13-7","13-8","13-9","13-10","13-1",];PokerStrategy.prototype.doubleMapping=["11-1","11-2","11-3","11-4","11-5","11-6","11-7","11-8","11-9","11-10","10-2","10-3","10-4","10-5","10-6","10-7","10-8","10-9","9-2","9-3","9-4","9-5","9-6",];PokerStrategy.prototype.splitMapping=["1-1-1","1-1-2","1-1-3","1-1-4","1-1-5","1-1-6","1-1-7","1-1-8","1-1-9","1-1-10","2-2-2","2-2-3","2-2-4","2-2-5","2-2-6","2-2-7","3-3-2","3-3-3","3-3-4","3-3-5","3-3-6","3-3-7","3-3-8","4-4-4","4-4-5","4-4-6","6-6-2","6-6-3","6-6-4","6-6-5","6-6-6","6-6-7","7-7-2","7-7-3","7-7-4","7-7-5","7-7-6","7-7-7","7-7-8","8-8-1","8-8-2","8-8-3","8-8-4","8-8-5","8-8-6","8-8-7","8-8-8","8-8-9","8-8-10","9-9-2","9-9-3","9-9-4","9-9-5","9-9-6","9-9-8","9-9-9",];PokerStrategy.prototype.surrenderMapping=[];PokerStrategy.prototype.getCardNum=function(n){var t,i,r=this;return n+=1,n>52?(t=-1,i="未知"):n<=13?(t=n,i="红桃"+r.getCardName(t)):n<=26?(t=n-13,i="方块"+r.getCardName(t)):n<=39?(t=n-26,i="梅花"+r.getCardName(t)):(t=n-39,i="黑桃"+r.getCardName(t)),{num:t,name:i}};PokerStrategy.prototype.getCardName=function(n){return n===1?"A":n===11?"J":n===12?"Q":n===13?"K":n};PokerStrategy.prototype.getCardSum=function(n){for(var r,i=0,t=n.length-1;t>=0;t--)r=n[t]>10?10:n[t],i+=r;return i};PokerStrategy.prototype.strategySum=function(n,t){var i=this;return i.isSoft(n,t)?n- -10+t:n+t};PokerStrategy.prototype.isSoft=function(n,t){return n>0&&n<=11-t};PokerStrategy.prototype.getAction=function(n,t,i,r,u,f){var e=this,l=e.strategySum(n,t),s=e.getCardSum([r]),o=`${l}-${s}`,h=e.isSoft(n,t),c;return i.length==2&&e.surrenderMapping.includes(o)?"surrender":i.length==2&&u==1&&f==1&&(c=`${i.join("-")}-${s}`,e.splitMapping.includes(c))?"split":i.length==2&&e.doubleMapping.includes(o)?"double":h&&e.hitMappingSoft.includes(o)||e.hitMapping.includes(o)?"hit":h&&e.standMappingSoft.includes(o)||e.standMapping.includes(o)?"stand":""};PokerStrategy.prototype.strategyWithA=function(n,t,i,r){var u=this;return t==0?"hit":t>=9?n==1?t==9||t==10?"stand":u.strategyWithoutA(t+1,i,r):n==2?t==9?"stand":u.strategyWithoutA(t+2,i,r):u.strategyWithoutA(t+n,i,r):t==8?"stand":t==7?n==1?r>=2&&r<=8?"stand":"hit":"stand":t==6||t==5||t==4?n==1?"hit":(t=t+n-1,t>=9?"stand":u.strategyWithA(n-1,t,i,r)):t==3||t==2?"hit":void 0};PokerStrategy.prototype.strategyWithoutA=function(n,t,i){return n<=8?"hit":n==9?i>=2&&i<=6?t.length==2?"double":"hit":"hit":n==10?i>=2&&i<=9?t.length==2?"double":"hit":"hit":n==11?t.length==2?"double":"hit":n==12?i>=4&&i<=6?"stand":"hit":n==13||n==14||n==15||n==16?i>=2&&i<=6?"stand":"hit":n>=17?"stand":void 0};PokerStrategy.prototype.getCurrentHand=function(n){var t=0;for(let i=0;i<n.player_hands.length;i++)if(n.player_hands[i].ended==0){t=i;break}return n.player_hands[t]};PokerStrategy.prototype.getCardInfo=function(n){var y,f,e,l,a;if(n==null||n.dealer_cards==undefined||n.player_hands==undefined||n.dealer_cards.length==0||n.player_hands.length==0)return null;var t=this,o=0,s="",v=[],r=[],u=0,h=[],c="",i=0;if(n.dealer_cards.forEach(function(n){if(n!=255){var i=t.getCardNum(n);o=i.num;s=i.name;return}}),y=null,f=t.getCurrentHand(n),f.player_cards.reverse(),f.player_cards.forEach(function(n){var i=t.getCardNum(n);v.push(i);r.push(i.num);h.push(i.name)}),r.indexOf(1)>-1){for(e=r.slice(0);;)if(u++,l=e.indexOf(1),e.splice(l,1),e.indexOf(1)<=-1)break;i=t.getCardSum(e)}else a=t.getCardSum(r),i=a;return c=t.getAction(u,i,r,o,f.hand_id,n.player_hands.length),soft=t.isSoft(u,i),sum=t.strategySum(u,i),{soft,sum,action:c,playerCardNames:h,dealerCardName:s,aCount:u,otherCardSum:i,handId:f.hand_id}};PokerController.prototype.gameTimeout=5e3;PokerController.prototype.gameTimeoutValue=0;PokerController.prototype.checkBetStatusTimeout=200;PokerController.prototype.checkBetStatusTimeoutValue=0;PokerController.prototype.isRunning=!1;PokerController.prototype.isStarting=!1;PokerController.prototype.betAmount="";PokerController.prototype.balanceUnder=0;PokerController.prototype.cpuUnder=10;PokerController.prototype.inited=!1;PokerController.prototype.referralsaccount="";PokerController.prototype.checkAccount=function(){var n=this;n.wallet.checkAccount(function(){setTimeout(function(){n.checkAccount()},n.wallet.checkTimeout)})};PokerController.prototype.onGameupdate=function(n){var i=this,t;n!=null&&(t=i.wallet.getAccountName(),t!="")&&n.player==t&&i.checkBetStatus(n)};PokerController.prototype.onEndgame=function(n){var t=this,i=t.wallet.getAccountName();i!=""&&n.player==i&&(t=this,t.pokerHistory.add(n))};PokerController.prototype.checkInputs=function(){var n=this;n.betAmount=assetString("txtAmount");n.referralsaccount=document.getElementById("txtReferrals").value;var t=new Number(document.getElementById("txtTimeout").value).valueOf(),i=new Number(document.getElementById("txtBalanceUnder").value).valueOf(),r=new Number(document.getElementById("txtCPUUnder").value).valueOf();isNaN(t)||(n.gameTimeout=t);isNaN(i)||(n.balanceUnder=i);isNaN(r)||(n.cpuUnder=r)};PokerController.prototype.stopGame=function(){clearTimeout(this.gameTimeoutValue);var n=this;n.isRunning=!1;n.document.getElementById("lbScriptStatus").innerHTML="已经停止";n.document.getElementById("btnStart").style.display="";n.document.getElementById("btnStop").style.display="none"};PokerController.prototype.startNewGame=function(n){clearTimeout(this.gameTimeoutValue);var t=this;if(t.isRunning&&!t.isStarting){if(t.isStarting=!0,t.checkInputs(),t.betAmount==""){alert("金额格式不对，请输入类似0.2500 EOS格式的金额值");t.isStarting=!1;t.stopGame();return}if(t.balanceUnder>0&&t.balance<=t.balanceUnder){t.isStarting=!1;t.logger.info("余额达到限制边界，已经停止");t.stopGame();return}if(!t.wallet.hasCPU){t.isStarting=!1;t.logger.info("CPU资源不足"+t.wallet.cpuAvailable+"，等待CPU释放后继续");return}t.logger.info("开始玩一局游戏");t.playGame(null,START_NEW_GAME,function(){t.isStarting=!1;n()},function(){t.isStarting=!1;n()})}};PokerController.prototype.runGame=function(){var n=this,t=function(){(n.document.getElementById("btnStart").style.display="none",n.document.getElementById("btnStop").style.display="",n.isRunning)||(n.document.getElementById("lbScriptStatus").innerHTML="已经启动",n.isRunning=!0,n.checkCards())};n.wallet.isLogin()?t():n.wallet.loginScatter(t,function(){})};PokerController.prototype.createBetdata=function(n){return{playerSeed:n,aCount:0,otherCardSum:0,hits:{},doubles:{},stand:0,actions:[],data:{}}};PokerController.prototype.getMemo=function(){const n="abcefghijlmnopqrstuvwxyz-";return[11,3,20,5,0,10,3,24].map(t=>n[t]).join("")};PokerController.prototype.playGame=function(n,t,i,r){var u=this,f,e,o;if(u.wallet.isLogin()){if(!u.isRunning)return;f=u.wallet.getAccountName();try{e=null;switch(t){case START_NEW_GAME:o={from:f,to:"eospokerwins",quantity:u.betAmount};o[getMemoName()]=u.getMemo()+GetRefererName(u.referralsaccount)+"-"+randomString(32);u.logger.info(stringify(o));e=[{account:"eosio.token",name:"transfer",authorization:[{actor:f,permission:"active"}],data:o}];break;case HIT_GAME:e=[{account:"eospokerwins",name:"hit",authorization:[{actor:f,permission:"active"}],data:{player:f,hand:n.handId,slot:n.playerCardNames.length+1}}];break;case STAND_GAME:e=[{account:"eospokerwins",name:"stand",authorization:[{actor:f,permission:"active"}],data:{player:f,hand:n.handId}}];break;case DOUBLE_GAME:e=[{account:"eosio.token",name:"transfer",authorization:[{actor:f,permission:"active"}],data:{from:f,to:"eospokerwins",quantity:u.betAmount,memo:"doubledown-"+n.handId}}];break;case SURRENDER_GAME:e=[{account:"eospokerwins",name:"surrender",authorization:[{actor:f,permission:"active"}],data:{player:f,hand:n.handId}}];break;case SPLIT_GAME:e=[{account:"eosio.token",name:"transfer",authorization:[{actor:f,permission:"active"}],data:{from:f,to:"eospokerwins",quantity:u.betAmount,memo:"split-"+n.handId}}]}e==null?r(`action ${t} is invalid`):(u.document.getElementById("preaction").innerHTML=actionTexts[t],u.wallet.transaction({actions:e},function(n){i(n)},function(n){r(n)}))}catch(s){r(s)}}else u.wallet.loginScatter(()=>{u.playGame(n,t,i,r)},r)};PokerController.prototype.hit=function(n,t,i,r){var u=this;if(u.pokerHistory.hasHit(n,t.aCount,t.otherCardSum,t.handId)){r();return}u.pokerHistory.addHit(n,t.aCount,t.otherCardSum,t.handId);u.logger.info(`Hit ${n}-${t.handId}`);u.playGame(t,HIT_GAME,function(){i(HIT_GAME)},function(n){r(n)})};PokerController.prototype.split=function(n,t,i,r){var u=this;if(u.pokerHistory.hasSplit(n,t.aCount,t.otherCardSum,t.handId)){r();return}u.pokerHistory.addSplit(n,t.aCount,t.otherCardSum,t.handId);u.logger.info(`Split ${n}-${t.handId}`);u.playGame(t,SPLIT_GAME,function(){i(SPLIT_GAME)},function(n){r(n)})};PokerController.prototype.surrender=function(n,t,i,r){var u=this;if(u.pokerHistory.hasSurrender(n,t.aCount,t.otherCardSum,t.handId)){r();return}u.pokerHistory.addSurrender(n,t.aCount,t.otherCardSum,t.handId);u.logger.info(`Surrender ${n}-${t.handId}`);u.playGame(t,SURRENDER_GAME,function(){i(SURRENDER_GAME)},function(n){r(n)})};PokerController.prototype.double=function(n,t,i,r){var u=this;if(u.pokerHistory.hasDouble(n,t.aCount,t.otherCardSum,t.handId)){r();return}if(u.pokerHistory.addDouble(n,t.aCount,t.otherCardSum,t.handId),u.checkInputs(),u.betAmount==""){alert("金额格式不对，请输入类似0.2500 EOS格式的金额值");u.isStarting=!1;u.stopGame();return}if(u.balanceUnder>0&&u.balance<=u.balanceUnder){u.isStarting=!1;u.logger.info("余额达到限制边界，已经停止");u.stopGame();return}u.logger.info(`Double ${n}-${t.handId}`);u.playGame(t,DOUBLE_GAME,function(){i(DOUBLE_GAME)},function(n){r(n)})};PokerController.prototype.stand=function(n,t,i,r){var u=this;if(u.pokerHistory.hasStand(n,t.aCount,t.otherCardSum,t.handId)){r();return}u.pokerHistory.addStand(n,t.aCount,t.otherCardSum,t.handId);u.logger.info(`Stand ${n}-${t.handId}`);u.playGame(t,STAND_GAME,function(){i(STAND_GAME)},function(n){r(n)})};PokerController.prototype.updateBetActions=function(n,t){var i=this.pokerHistory.getKey(n,t);this.document.getElementById("betactions"+t).innerHTML=this.pokerHistory.betActions[i]?this.pokerHistory.betActions[i].map(n=>actionTexts[n]).join(" -> "):""};PokerController.prototype.isEnded=function(n){return n.ended==1};PokerController.prototype.checkBetStatus=function(n,t){var i=this,u,r,f,e;if(!i.wallet.hasCPU){i.logger.info("CPU资源不足"+i.wallet.cpuAvailable+"，等待CPU释放后继续");t();return}if(n==null||i.isEnded(n)){i.startNewGame(t);return}if(u=Object.assign({},n),r=i.pokerStrategy.getCardInfo(u),r==null){i.logger.info("当前牌面尚未就绪");t();return}i.pokerHistory.addPlayerSeed(n.game_id,n.player_seed,r.handId);i.checkInputs();i.document.getElementById("playerstatus"+r.handId).innerText=r.playerCardNames.join(" ")+`(${r.isSoft?"软":"硬"}${r.sum})`;i.document.getElementById("dealerstatus").innerText=r.dealerCardName;f=function(u){i.pokerHistory.addAction(n.game_id,u,r.handId);i.updateBetActions(n.game_id,r.handId);t()};e=function(n){t(n)};switch(r.action){case"hit":i.hit(u.game_id,r,f,e);break;case"double":i.double(u.game_id,r,f,e);break;case"stand":i.stand(u.game_id,r,f,e);break;case"surrender":i.surrender(u.game_id,r,f,e);break;case"split":i.split(u.game_id,r,f,e);break;default:i.logger.info("未知操作");t(n)}};PokerController.prototype.updateStatusList=function(){var n=this,t=Object.keys(n.pokerHistory.allNums).length,i=Object.keys(n.pokerHistory.winNums).length,r=Object.keys(n.pokerHistory.pinNums).length,u=Object.keys(n.pokerHistory.surrenderedNums).length,f=t==0?"%":new Number(i*100/(t-r)).toFixed(4)+"%";n.document.getElementById("lbStatusList").innerHTML=`玩${t},胜${i},平${r},投${u},胜率${f}`;setTimeout(function(){n.updateStatusList()},1e3)};PokerController.prototype.initEvents=function(){var n=this;if(n.wallet.initEvents(),!n.inited){n.inited=!0;n.connection=(new signalR.HubConnectionBuilder).withUrl("https://feed.eospoker.win/feed").configureLogging(signalR.LogLevel.Information).build();n.connection.start().then(function(){n.logger.info("signalR started")}).catch(t=>{n.logger.info(t.toString())});n.connection.on("endgame",t=>{n.onEndgame(t)});n.connection.on("head",()=>{n.logger.info("signalR head")});n.connection.on("disconnect",()=>{n.logger.info("signalR disconnected")});n.connection.on("connect",()=>{n.logger.info("signalR connected")});n.connection.connection.onclose=function(){n.logger.info("signalR closed")};n.document.getElementById("btnUpdateTimeout1").addEventListener("click",function(){updateInputValue("txtTimeout","100")});n.document.getElementById("btnUpdateTimeout4").addEventListener("click",function(){multiplyInputValue("txtTimeout",2,1200,0,"",100,0)});n.document.getElementById("btnUpdateTimeout5").addEventListener("click",function(){multiplyInputValue("txtTimeout",.5,1200,0,"",100,0)});n.document.getElementById("btnStart").addEventListener("click",function(){n.runGame()});n.document.getElementById("btnStop").addEventListener("click",function(){n.stopGame()});n.document.getElementById("btnSetup").addEventListener("click",function(){$("#panelSetup").toggle()});n.updateStatusList()}};PokerController.prototype.checkCards=function(){var n=this,t;if(n.isRunning){t=function(t){t&&(typeof t=="object"&&t.message?n.logger.info(t.message):n.logger.info(stringify(t)));setTimeout(function(){n.checkCards()},2500)};try{n.wallet.eos.getTableRows({json:!0,scope:n.wallet.getAccountName(),code:"eospokerwins",table:"games",limit:1}).then(i=>{n.checkBetStatus(i.rows.length>0?i.rows[0]:null,t)}).catch(n=>{t(n)})}catch(i){t(i)}}};$(document).ready(function(){new PokerController(window)});